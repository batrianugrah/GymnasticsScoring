{% extends 'layout.html' %}
{% block title %}Laporan: {{ event.nama }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
    <div>
        <h1 class="mb-0">Laporan Hasil Akhir</h1>
        <p class="lead mb-0">Event: <strong>{{ event.nama }}</strong></p>
    </div>
    <a href="{{ url_for('export_laporan_pdf', event_id=event.id) }}" class="btn btn-danger btn-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        Download PDF
    </a>
</div>

{% for group_key, summaries in report_data.items() | sort %}
    <div class="category-block mb-4">
        <h4 class="border-bottom pb-2 mb-3">{{ group_key }}</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th>Nama Peserta</th>
                        <th>Daerah</th>
                        <th style="width: 35%;">Rincian Skor per Alat</th>
                        <th style="width: 15%;">TOTAL AKHIR</th>
                    </tr>
                </thead>
                <tbody>
                    {% for summary in summaries %}
                    <tr>
                        <td class="align-middle"><strong>{{ loop.index }}</strong></td>
                        <td class="align-middle"><a href="{{ url_for('profil_peserta', peserta_id=summary.peserta.id) }}" class="participant-link">{{ summary.peserta.nama }}</a></td>
                        <td class="align-middle">{{ summary.peserta.daerah.nama }}</td>
                        <td>
                            {% for alat, nilai in summary.skor_alat.items() | sort %}
                                <div class="d-flex justify-content-between border-bottom py-1"><span>{{ alat }}:</span><span>{{ "%.3f"|format(nilai) }}</span></div>
                            {% endfor %}
                        </td>
                        <td class="align-middle text-center"><span class="badge bg-primary fs-6">{{ "%.3f"|format(summary.total_skor) }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% else %}
    <div class="alert alert-info">Belum ada skor yang tercatat untuk event ini.</div>
{% endfor %}

{% endblock %}